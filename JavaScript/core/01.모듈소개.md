# 자바스크립트 모듈 소개

---

## 1. 모듈이란

- 모듈 = 파일 하나
- 각 파일은 독립된 스코프를 가지며, 필요한 기능만 내보내고(import/export) 공유
- 과거에는 AMD, CommonJS, UMD 등 다양한 모듈 시스템이 존재했지만 지금은 **표준 ES Modules** 사용이 일반적

---

## 2. 기본 사용법 (export / import)

```js
// 📁 sayHi.js
export function sayHi(user) {
  return `Hello, ${user}!`;
}
```

```js
// 📁 main.js
import { sayHi } from "./sayHi.js";

console.log(sayHi("John")); // Hello, John!
```

```html
<!-- 📁 index.html -->
<!DOCTYPE html>
<script type="module">
  import { sayHi } from "./sayHi.js";
  document.body.textContent = sayHi("John");
</script>
```

> 브라우저에서 모듈을 쓰려면 `<script type="module">` 필요  
> 로컬 파일(`file://`)은 동작하지 않음 → 반드시 **HTTP/HTTPS 서버** 필요

---

## 3. 모듈의 특징

1. **항상 엄격 모드(`use strict`)**

   ```js
   <script type="module">a = 5; // 에러 (선언 없는 변수 사용 불가)</script>
   ```

2. **모듈 레벨 스코프**

   - 변수/함수는 모듈 내부에만 존재
   - 외부 공유하려면 `export` 필요

3. **단 한 번만 실행됨**

   - 여러 곳에서 import해도 최초 한 번만 평가
   - 객체나 값은 공유됨

   ```js
   // 📁 admin.js
   export let admin = { name: "John" };

   // 📁 a.js
   import { admin } from "./admin.js";
   admin.name = "Pete";

   // 📁 b.js
   import { admin } from "./admin.js";
   console.log(admin.name); // Pete (같은 객체 공유)
   ```

---

## 4. 브라우저 환경에서 모듈

- `<script type="module">`는 **자동 defer** → HTML 파싱 끝난 후 실행
- 모듈 순서는 HTML에 작성된 순서대로 실행됨
- 외부 오리진에서 불러올 경우 **CORS 헤더 필요**
- **중복 import는 무시** → 같은 모듈은 한 번만 실행
- **경로 없는 import 금지** → 반드시 `./` 또는 절대 경로 필요

```js
import { sayHi } from "sayHi"; // ❌ 에러
import { sayHi } from "./sayHi.js"; // ✅
```

---

## 5. 고급 기능

- **import.meta**

  ```js
  console.log(import.meta.url); // 현재 모듈의 URL
  ```

- **this**

  ```js
  console.log(this); // undefined (모듈 최상위 this는 없음)
  ```

- **async 모듈** (비동기 인라인 스크립트)

  ```html
  <script async type="module">
    import { counter } from "./analytics.js";
    counter.count();
  </script>
  ```

- **구식 브라우저 대응 (`nomodule`)**
  ```html
  <script type="module" src="main.js"></script>
  <script nomodule src="legacy.js"></script>
  ```

---

## 6. 번들러와 모듈

- 실제 배포에선 보통 **Webpack, Rollup, Vite** 같은 번들러 사용
- 역할:
  - 모든 모듈을 분석 → 하나(또는 여러 개)의 번들 파일로 묶음
  - 트리 셰이킹(쓰이지 않는 코드 제거)
  - 최신 문법 변환(Babel)
  - 코드 압축/최적화
- 번들된 결과물은 일반 `<script>`로 불러올 수 있음

```html
<script src="bundle.js"></script>
```

---

## 7. 요약

- 모듈 = 파일 하나, `export`와 `import`로 기능 공유
- 브라우저에선 `<script type="module">` 필수, 경로 반드시 명시
- 모듈은 **엄격 모드**, **독립 스코프**, **단 한 번만 실행**
- 외부 오리진 → CORS 필요
- 프로덕션 환경에선 **번들러** 사용으로 최적화

---
